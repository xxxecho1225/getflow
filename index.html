<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI 门店获客助手 - 手机行业专业版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/lucide-static@0.321.0/font/lucide.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --ant-primary: #1890ff;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: #f7f8fa;
            -webkit-tap-highlight-color: transparent;
            color: #333;
        }

        .custom-scroll::-webkit-scrollbar { display: none; }
        
        .tab-bar {
            padding-bottom: calc(0.5rem + var(--safe-bottom));
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-top: 1px solid #eeeeee;
        }

        .view-container {
            padding-bottom: calc(6rem + var(--safe-bottom));
        }

        .btn-primary { 
            background-color: var(--ant-primary); 
            transition: all 0.2s;
        }
        .btn-primary:active { transform: scale(0.96); opacity: 0.9; }

        .page-fade { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .scenario-card.active { border: 2.5px solid var(--ant-primary); background-color: #e6f7ff; transform: translateY(-2px); }
        
        .upload-area { 
            border: 2px dashed #d1d5db;
            transition: all 0.3s;
        }
        .upload-area:active { background-color: #f0f7ff; border-color: var(--ant-primary); }

        .form-input { 
            width: 100%; 
            padding: 0.75rem 1rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.75rem; 
            outline: none;
            background: white;
            font-size: 14px;
        }
        .form-input:focus { border-color: var(--ant-primary); box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1); }
        
        .pain-point-card { border: 1.5px solid #ebebeb; transition: all 0.2s; }
        .pain-point-card.active { border-color: var(--ant-primary); background-color: #f0f7ff; }
        
        .keyword-tag { background: #f0f2f5; color: #666; padding: 4px 12px; border-radius: 20px; font-size: 12px; border: 1px solid #e1e4e8; }
        
        .type-btn { transition: all 0.2s; border: 1px solid #d1d5db; }
        .type-btn.active { border-color: var(--ant-primary); background-color: #e6f7ff; color: var(--ant-primary); font-weight: bold; }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- 1. 登录与注册模块 -->
    <div id="view-login" class="min-h-screen bg-white flex flex-col items-center justify-center px-10 page-fade">
        <div class="w-full max-w-sm">
            <div class="mb-12 text-center">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-700 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl rotate-3">
                    <i class="lucide-zap text-white w-10 h-10"></i>
                </div>
                <h1 class="text-2xl font-black text-gray-900 tracking-tight">AI 门店获客助手</h1>
                <p class="text-gray-400 text-sm mt-2 font-medium tracking-wide italic">MOBILE RETAIL INTELLIGENCE</p>
            </div>
            <div class="space-y-4">
                <input type="text" placeholder="手机号" class="form-input text-lg py-4" id="login-phone" value="13800138000">
                <input type="password" placeholder="密码" class="form-input text-lg py-4" id="login-pass" value="123456">
                <button onclick="handleAuth('login')" class="w-full btn-primary text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-blue-100">登录账号</button>
                <div class="flex justify-between text-xs text-gray-400 font-bold px-1 pt-2 uppercase tracking-widest">
                    <button onclick="switchAuthMode('register')">新用户注册</button>
                    <button>找回密码</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-register" class="min-h-screen bg-white hidden flex flex-col items-center justify-center px-10 page-fade">
        <div class="w-full max-w-sm">
            <h2 class="text-3xl font-black mb-2">注册</h2>
            <p class="text-gray-400 mb-8 text-sm">加入增长计划</p>
            <div class="space-y-4">
                <input type="text" placeholder="手机号" class="form-input py-4">
                <input type="text" placeholder="门店名称" class="form-input py-4">
                <input type="password" placeholder="设置密码" class="form-input py-4">
                <button onclick="handleAuth('register')" class="w-full btn-primary text-white py-4 rounded-2xl font-bold text-lg shadow-xl">立即注册并登录</button>
                <button onclick="switchAuthMode('login')" class="w-full text-gray-400 text-xs mt-6 font-bold uppercase tracking-widest underline decoration-2 text-center">返回登录</button>
            </div>
        </div>
    </div>

    <!-- 2. 主程序界面 -->
    <div id="main-app" class="hidden min-h-screen bg-[#f7f8fa]">
        
        <!-- Tab 1: 工作台 -->
        <div id="content-generator" class="view-container page-fade">
            <header class="bg-white px-6 pt-12 pb-6 shadow-sm sticky top-0 z-40">
                <div class="flex justify-between items-end">
                    <div>
                        <span class="text-[10px] font-black text-blue-600 uppercase tracking-[0.2em] mb-1 block">Workbench</span>
                        <h2 class="text-2xl font-black text-gray-900" id="welcome-text">你好, 店长</h2>
                    </div>
                    <div class="flex flex-col items-end">
                        <div id="step-indicator" class="flex space-x-1 mb-2">
                            <div class="w-6 h-1 rounded-full bg-blue-600"></div>
                            <div class="w-6 h-1 rounded-full bg-gray-200"></div>
                            <div class="w-6 h-1 rounded-full bg-gray-200"></div>
                        </div>
                        <span class="text-[9px] text-gray-400 font-bold uppercase">Step <span id="step-num">1</span> / 3</span>
                    </div>
                </div>
            </header>

            <div class="p-5">
                <div id="generator-wizard">
                    
                    <!-- STEP 1: 选择营销场景 -->
                    <div id="step-content-1" class="space-y-6">
                        <div class="grid grid-cols-3 gap-3">
                            <div onclick="selectMainScenario('activity')" id="main-activity" class="scenario-card p-4 rounded-2xl border bg-white shadow-sm flex flex-col items-center">
                                <div class="w-10 h-10 bg-red-50 text-red-500 rounded-full flex items-center justify-center mb-2 font-black">促</div>
                                <span class="text-xs font-bold">活动营销</span>
                            </div>
                            <div onclick="selectMainScenario('new')" id="main-new" class="scenario-card p-4 rounded-2xl border bg-white shadow-sm flex flex-col items-center">
                                <div class="w-10 h-10 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mb-2 font-black">新</div>
                                <span class="text-xs font-bold">新品上市</span>
                            </div>
                            <div onclick="selectMainScenario('daily')" id="main-daily" class="scenario-card p-4 rounded-2xl border bg-white shadow-sm flex flex-col items-center">
                                <div class="w-10 h-10 bg-green-50 text-green-500 rounded-full flex items-center justify-center mb-2 font-black">换</div>
                                <span class="text-xs font-bold">日常换机</span>
                            </div>
                        </div>

                        <div id="sub-form-container" class="hidden animate-fade-in space-y-5">
                            <!-- 场景 A: 活动营销细节 -->
                            <div id="form-activity" class="hidden space-y-4">
                                <div class="bg-white p-5 rounded-2xl shadow-sm space-y-4 border border-gray-100">
                                    <h4 class="text-xs font-black text-gray-400 uppercase tracking-widest">活动详情设置</h4>
                                    <select id="activity-type" onchange="toggleActivitySubForm()" class="form-input">
                                        <option value="promo">大促活动 (618/双11等)</option>
                                        <option value="festival">节日活动 (五一/春节等)</option>
                                        <option value="policy" selected>政策补贴活动</option>
                                        <option value="store">门店专属活动</option>
                                    </select>
                                    
                                    <!-- 时间段选择 (大促/节日显示) -->
                                    <div id="sub-promo-festival" class="hidden space-y-3">
                                        <label class="text-[10px] font-black text-blue-600 uppercase tracking-widest block ml-1">活动阶段</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <button onclick="togglePromoPhase('preheat')" id="btn-promo-preheat" class="type-btn py-3 rounded-xl text-xs font-bold transition-all">预热期</button>
                                            <button onclick="togglePromoPhase('ongoing')" id="btn-promo-ongoing" class="type-btn py-3 rounded-xl text-xs font-bold transition-all">进行中</button>
                                        </div>
                                    </div>

                                    <!-- 子选项: 政策补贴 (国补/以旧换新) -->
                                    <div id="sub-policy" class="space-y-4">
                                        <div class="grid grid-cols-2 gap-2">
                                            <button onclick="togglePolicyType('national')" id="btn-policy-national" class="type-btn py-3 rounded-xl text-xs font-bold active">国补活动</button>
                                            <button onclick="togglePolicyType('tradein')" id="btn-policy-tradein" class="type-btn py-3 rounded-xl text-xs font-bold">以旧换新</button>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2">
                                            <select id="policy-province" onchange="updateCityOptions()" class="form-input text-xs">
                                                <option value="">选择省份</option>
                                                <option value="广东省">广东省</option>
                                                <option value="北京市">北京市</option>
                                                <option value="上海市">上海市</option>
                                                <option value="浙江省">浙江省</option>
                                            </select>
                                            <select id="policy-city" class="form-input text-xs">
                                                <option value="">选择城市</option>
                                            </select>
                                        </div>
                                        <select id="policy-brand" class="form-input text-sm">
                                            <option value="">选择品牌</option>
                                            <option>华为</option><option>苹果</option><option>荣耀</option>
                                            <option>小米</option><option>vivo</option><option>oppo</option>
                                        </select>
                                    </div>

                                    <!-- 子选项: 门店专属 (精简版) -->
                                    <div id="sub-store" class="hidden space-y-3">
                                        <label class="text-[10px] font-black text-blue-600 uppercase tracking-widest block ml-1">专属优惠方式</label>
                                        <div class="grid grid-cols-1 gap-2">
                                            <button onclick="selectStoreOffer('discount')" id="btn-store-discount" class="type-btn py-3 rounded-xl text-xs font-bold">产品折扣降价</button>
                                            <button onclick="selectStoreOffer('bundle')" id="btn-store-bundle" class="type-btn py-3 rounded-xl text-xs font-bold">组合优惠</button>
                                            <button onclick="selectStoreOffer('gift')" id="btn-store-gift" class="type-btn py-3 rounded-xl text-xs font-bold">赠品活动</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 场景 B: 新品上市细节 -->
                            <div id="form-new" class="hidden space-y-4">
                                <div class="bg-white p-5 rounded-2xl shadow-sm space-y-4 border border-gray-100">
                                    <h4 class="text-xs font-black text-gray-400 uppercase tracking-widest">新机首发</h4>
                                    <select id="new-brand" class="form-input">
                                        <option>华为 Huawei</option><option>苹果 Apple</option><option>荣耀 Honor</option>
                                        <option>小米 Xiaomi</option><option>vivo</option><option>oppo</option>
                                    </select>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="toggleNewPhase('before')" id="btn-phase-before" class="type-btn py-3 rounded-xl text-xs font-bold active">上市前</button>
                                        <button onclick="toggleNewPhase('during')" id="btn-phase-during" class="type-btn py-3 rounded-xl text-xs font-bold">上市中</button>
                                    </div>
                                    <select id="new-action" onchange="toggleOldDeviceField()" class="form-input text-sm">
                                        <option>新品预订</option><option>价格预测</option>
                                    </select>
                                    <div id="old-device-container" class="hidden">
                                        <input type="text" id="old-device-name" placeholder="输入对比的旧机型号 (如: iPhone 13)" class="form-input text-xs border-orange-200">
                                    </div>
                                </div>
                            </div>

                            <!-- 场景 C: 日常换机细节 -->
                            <div id="form-daily" class="hidden space-y-4">
                                <div class="bg-white p-5 rounded-2xl shadow-sm">
                                    <h4 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">核心流量痛点</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="pain-point-card p-3 rounded-xl flex flex-col cursor-pointer" onclick="selectPainPoint(this, '手机拍照不行', '19.4亿')">
                                            <span class="text-xs font-bold">拍照不行</span>
                                            <span class="text-[9px] text-gray-400 mt-1">19.4亿人浏览</span>
                                        </div>
                                        <div class="pain-point-card p-3 rounded-xl flex flex-col cursor-pointer" onclick="selectPainPoint(this, '内存不够', '3.7亿')">
                                            <span class="text-xs font-bold">内存不够</span>
                                            <span class="text-[9px] text-gray-400 mt-1">3.7亿人浏览</span>
                                        </div>
                                        <div class="pain-point-card p-3 rounded-xl flex flex-col cursor-pointer" onclick="selectPainPoint(this, '手机卡顿', '3.1亿')">
                                            <span class="text-xs font-bold">手机卡顿</span>
                                            <span class="text-[9px] text-gray-400 mt-1">3.1亿人浏览</span>
                                        </div>
                                        <div class="pain-point-card p-3 rounded-xl flex flex-col cursor-pointer" onclick="selectPainPoint(this, '电池不耐用', '2.9亿')">
                                            <span class="text-xs font-bold">电池不耐用</span>
                                            <span class="text-[9px] text-gray-400 mt-1">2.9亿人浏览</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button onclick="goToStep(2)" class="w-full btn-primary text-white py-5 rounded-2xl font-black text-lg shadow-xl shadow-blue-200">下一步：AI 智能分析</button>
                    </div>

                    <!-- STEP 2: AI 分析 -->
                    <div id="step-content-2" class="hidden space-y-6 animate-fade-in">
                        <div class="bg-white p-5 rounded-2xl shadow-sm">
                            <h4 class="text-xs font-black text-blue-600 uppercase mb-3">SEO 智能关键词建议</h4>
                            <div class="flex flex-wrap gap-2" id="keyword-tags"></div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-600 to-blue-800 p-5 rounded-3xl shadow-xl text-white">
                            <h4 class="text-xs font-bold uppercase opacity-60 mb-4 tracking-widest text-center">AI 推荐发帖战略</h4>
                            <div id="theme-suggestions-list" class="space-y-3"></div>
                        </div>
                        <div class="space-y-4">
                            <input id="input-product-name" type="text" placeholder="确定推介机型名称" class="form-input text-center py-4 text-lg font-bold border-blue-100 shadow-sm">
                            <label for="image-upload" class="upload-area w-full rounded-2xl p-10 flex flex-col items-center justify-center bg-white shadow-sm border-2 border-dashed border-gray-200">
                                <i class="lucide-camera text-blue-500 w-10 h-10 mb-2"></i>
                                <span class="text-xs text-gray-500 font-bold" id="upload-filename">点击开启摄像头拍摄或上传</span>
                                <input type="file" id="image-upload" onchange="handleFileChange(this)" class="hidden">
                            </label>
                        </div>
                        <div class="flex gap-3 pt-4">
                            <button onclick="goToStep(1)" class="flex-1 bg-white border border-gray-200 text-gray-500 py-4 rounded-2xl font-bold">返回修改</button>
                            <button onclick="generateContent()" class="flex-[2] btn-primary text-white py-4 rounded-2xl font-black shadow-xl">生成正式笔记</button>
                        </div>
                    </div>

                    <!-- STEP 3: 结果展示 -->
                    <div id="step-content-3" class="hidden space-y-6 animate-fade-in">
                        <div class="bg-white p-5 rounded-3xl shadow-lg border-2 border-gray-50">
                            <canvas id="preview-canvas" class="w-full rounded-2xl bg-gray-50 shadow-inner mb-4"></canvas>
                            <div class="p-3 bg-yellow-50 rounded-xl text-[10px] text-yellow-800 font-medium text-center italic">AI P-图文字建议：【同城国补 · 现货即拿】</div>
                        </div>
                        <div id="titles-container" class="space-y-3"></div>
                        <div id="template-viewer" class="hidden p-6 border-2 border-blue-100 rounded-3xl bg-white shadow-2xl relative">
                            <div class="flex justify-between items-center mb-4 border-b border-gray-50 pb-3">
                                <span class="text-[10px] font-black text-blue-600 uppercase">Note Body Template</span>
                                <button onclick="copyContent()" class="bg-blue-600 text-white px-4 py-1.5 rounded-full text-[10px] font-bold shadow-lg">复制全文</button>
                            </div>
                            <div class="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed max-h-[350px] overflow-y-auto custom-scroll font-medium" id="full-template-text"></div>
                        </div>
                        <button onclick="saveAndReturnHome()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-black text-lg shadow-xl shadow-green-100">确认发布 · 返回首页</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: 历史记录 -->
        <div id="content-history" class="view-container p-6 hidden page-fade">
            <h2 class="text-3xl font-black mb-8 pt-4">历史记录</h2>
            <div id="history-list" class="space-y-4">
                <div class="text-center py-20 text-gray-300">暂无生成记录</div>
            </div>
        </div>

        <!-- Tab 3: 个人中心 -->
        <div id="content-profile" class="view-container hidden page-fade">
            <div class="bg-gradient-to-br from-blue-600 to-blue-800 pt-20 pb-16 px-8 rounded-b-[4rem] shadow-2xl">
                <div class="flex items-center space-x-5">
                    <div class="w-20 h-20 rounded-3xl bg-white/20 border-4 border-white/20 backdrop-blur-md flex items-center justify-center shadow-2xl">
                        <i class="lucide-user-2 text-white w-10 h-10"></i>
                    </div>
                    <div class="text-white">
                        <h3 class="text-2xl font-black tracking-tight" id="profile-name">店长阿明</h3>
                        <p class="opacity-70 text-[10px] font-bold uppercase tracking-widest mt-1" id="profile-store">广州天河城旗舰店</p>
                    </div>
                </div>
            </div>
            <div class="px-6 -mt-8">
                <div class="bg-white rounded-[2.5rem] shadow-xl p-4 space-y-2 border border-gray-50">
                    <button onclick="showSubPage('editProfile')" class="w-full flex items-center justify-between p-5 hover:bg-gray-50 rounded-2xl transition-all">
                        <div class="flex items-center space-x-4"><div class="w-10 h-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600"><i class="lucide-user-cog w-5 h-5"></i></div><span class="font-bold text-gray-700">修改资料信息</span></div>
                        <i class="lucide-chevron-right text-gray-200"></i>
                    </button>
                    <button onclick="showSubPage('changePassword')" class="w-full flex items-center justify-between p-5 hover:bg-gray-50 rounded-2xl transition-all">
                        <div class="flex items-center space-x-4"><div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600"><i class="lucide-lock w-5 h-5"></i></div><span class="font-bold text-gray-700">安全与密码修改</span></div>
                        <i class="lucide-chevron-right text-gray-200"></i>
                    </button>
                    <button onclick="handleLogout()" class="w-full flex items-center space-x-4 p-5 text-red-500 hover:bg-red-50 rounded-2xl transition-all font-black">
                        <div class="w-10 h-10 bg-red-50 rounded-xl flex items-center justify-center text-red-600"><i class="lucide-log-out w-5 h-5"></i></div>
                        <span>退出登录</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 底部导航栏 -->
        <nav class="tab-bar fixed bottom-0 left-0 right-0 h-24 flex justify-around items-center px-6 z-50">
            <button onclick="switchTab('generator')" id="nav-gen" class="nav-item active flex flex-col items-center space-y-1 text-blue-600">
                <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200 -mt-8 mb-1"><i class="lucide-sparkles w-6 h-6"></i></div>
                <span class="text-[9px] font-black uppercase tracking-widest">撰写</span>
            </button>
            <button onclick="switchTab('history')" id="nav-his" class="nav-item flex flex-col items-center space-y-1 text-gray-300">
                <i class="lucide-scroll-text w-6 h-6"></i>
                <span class="text-[9px] font-black uppercase tracking-widest">历史</span>
            </button>
            <button onclick="switchTab('profile')" id="nav-pro" class="nav-item flex flex-col items-center space-y-1 text-gray-300">
                <i class="lucide-layout-grid w-6 h-6"></i>
                <span class="text-[9px] font-black uppercase tracking-widest">设置</span>
            </button>
        </nav>
    </div>

    <!-- 子页面: 修改资料 -->
    <div id="subpage-editProfile" class="fixed inset-0 bg-white hidden z-[100] page-fade p-8">
        <button onclick="hideSubPage('editProfile')" class="w-12 h-12 rounded-2xl bg-gray-50 flex items-center justify-center mb-10"><i class="lucide-chevron-left text-gray-600"></i></button>
        <h2 class="text-2xl font-black mb-8">修改资料</h2>
        <div class="space-y-4">
            <input type="text" id="edit-name" value="店长阿明" class="form-input py-4 font-bold">
            <input type="text" id="edit-store" value="广州天河城旗舰店" class="form-input py-4 font-bold">
            <button onclick="saveProfileInfo()" class="w-full btn-primary text-white py-5 rounded-2xl font-black shadow-xl mt-6">保存修改</button>
        </div>
    </div>

    <!-- 子页面: 修改密码 -->
    <div id="subpage-changePassword" class="fixed inset-0 bg-white hidden z-[100] page-fade p-8">
        <button onclick="hideSubPage('changePassword')" class="w-12 h-12 rounded-2xl bg-gray-50 flex items-center justify-center mb-10"><i class="lucide-chevron-left"></i></button>
        <h2 class="text-2xl font-black mb-8">安全中心</h2>
        <div class="space-y-4">
            <input type="password" class="form-input py-4 shadow-sm" placeholder="当前密码">
            <input type="password" class="form-input py-4 shadow-sm" placeholder="设置新密码">
            <button onclick="saveNewPassword()" class="w-full btn-primary text-white py-5 rounded-2xl font-black shadow-xl mt-6">更新密码</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-lg text-white px-8 py-3 rounded-2xl text-xs font-black hidden z-[1000] shadow-2xl tracking-widest animate-fade-in uppercase">MESSAGE</div>

    <script>
        let userState = { isLoggedIn: false, name: "店长阿明", store: "广州天河城旗舰店" };
        let historyData = [];
        let currentStep = 1;
        let mainScenario = '';
        let selectedPainPoint = '';
        let currentPromoPhase = 'ongoing';
        let currentPolicyType = 'national';
        
        const regionData = {
            "广东省": ["广州市", "深圳市", "珠海市", "东莞市", "佛山市"],
            "北京市": ["北京市"],
            "上海市": ["上海市"],
            "浙江省": ["杭州市", "宁波市", "温州市"]
        };

        function switchView(viewId) {
            ['view-login', 'view-register', 'main-app'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
        }

        function switchAuthMode(mode) {
            switchView(mode === 'login' ? 'view-login' : 'view-register');
        }

        function switchTab(tabId) {
            document.querySelectorAll('.view-container').forEach(c => c.classList.add('hidden'));
            document.getElementById('content-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'text-blue-600');
                item.classList.add('text-gray-300');
            });
            const activeNav = { 'generator': 'nav-gen', 'history': 'nav-his', 'profile': 'nav-pro' }[tabId];
            document.getElementById(activeNav).classList.add('active', 'text-blue-600');
            document.getElementById(activeNav).classList.remove('text-gray-300');
            if(tabId === 'history') renderHistory();
        }

        function handleAuth(type) {
            userState.isLoggedIn = true;
            document.getElementById('welcome-text').innerText = `你好, ${userState.name}`;
            switchView('main-app');
            switchTab('generator');
        }

        function handleLogout() { switchView('view-login'); }
        function saveProfileInfo() { showToast("更新成功"); hideSubPage('editProfile'); }
        function saveNewPassword() { showToast("重置成功"); hideSubPage('changePassword'); }

        function selectMainScenario(type) {
            mainScenario = type;
            document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
            document.getElementById('main-' + type).classList.add('active');
            document.getElementById('sub-form-container').classList.remove('hidden');
            ['activity', 'new', 'daily'].forEach(s => document.getElementById('form-' + s).classList.add('hidden'));
            document.getElementById('form-' + type).classList.remove('hidden');
            if(type === 'activity') toggleActivitySubForm();
        }

        function toggleActivitySubForm() {
            const type = document.getElementById('activity-type').value;
            const isEvent = (type === 'promo' || type === 'festival');
            document.getElementById('sub-promo-festival').classList.toggle('hidden', !isEvent);
            document.getElementById('sub-policy').classList.toggle('hidden', type !== 'policy');
            document.getElementById('sub-store').classList.toggle('hidden', type !== 'store');
            if(isEvent) togglePromoPhase('ongoing');
        }

        function togglePromoPhase(phase) {
            currentPromoPhase = phase;
            document.getElementById('btn-promo-preheat').className = phase === 'preheat' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
            document.getElementById('btn-promo-ongoing').className = phase === 'ongoing' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
        }

        function togglePolicyType(type) {
            currentPolicyType = type;
            document.getElementById('btn-policy-national').className = type === 'national' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
            document.getElementById('btn-policy-tradein').className = type === 'tradein' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
        }

        function selectStoreOffer(type) {
            document.getElementById('btn-store-discount').className = type === 'discount' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
            document.getElementById('btn-store-bundle').className = type === 'bundle' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
            document.getElementById('btn-store-gift').className = type === 'gift' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
        }

        function updateCityOptions() {
            const prov = document.getElementById('policy-province').value;
            const cityEl = document.getElementById('policy-city');
            cityEl.innerHTML = '<option value="">选择城市</option>';
            if(prov && regionData[prov]) {
                regionData[prov].forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c;
                    cityEl.appendChild(opt);
                });
            }
        }

        function toggleNewPhase(phase) {
            document.getElementById('btn-phase-before').className = phase === 'before' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
            document.getElementById('btn-phase-during').className = phase === 'during' ? "type-btn py-3 rounded-xl text-xs font-bold active" : "type-btn py-3 rounded-xl text-xs font-bold";
            const select = document.getElementById('new-action');
            if(phase === 'before') select.innerHTML = '<option>新品预订</option><option>价格预测</option><option>宣发动态</option>';
            else select.innerHTML = '<option>新品开箱</option><option>首发体验</option><option>对比测评</option><option>购机攻略</option>';
            toggleOldDeviceField();
        }

        function toggleOldDeviceField() {
            const action = document.getElementById('new-action').value;
            document.getElementById('old-device-container').classList.toggle('hidden', action !== '对比测评');
        }

        function selectPainPoint(el, title, heat) {
            selectedPainPoint = title;
            document.querySelectorAll('.pain-point-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
        }

        function goToStep(s) {
            if(s === 2 && !mainScenario) return showToast('请选择业务场景');
            document.getElementById(`step-content-${currentStep}`).classList.add('hidden');
            document.getElementById(`step-content-${s}`).classList.remove('hidden');
            document.getElementById('step-num').innerText = s;
            const indicators = document.getElementById('step-indicator').children;
            for(let i=0; i<3; i++) indicators[i].className = i < s ? "w-6 h-1 rounded-full bg-blue-600 transition-all duration-500" : "w-6 h-1 rounded-full bg-gray-200 transition-all duration-500";
            if(s === 2) renderStep2();
            currentStep = s;
            window.scrollTo(0, 0);
        }

        function renderStep2() {
            const tagContainer = document.getElementById('keyword-tags');
            tagContainer.innerHTML = '';
            const words = mainScenario === 'daily' ? [selectedPainPoint, '同城换机', '高性价比'] : ['国补直降', '门店现货', '数码测评'];
            words.forEach(w => {
                const span = document.createElement('span');
                span.className = 'keyword-tag font-bold';
                span.innerText = w;
                tagContainer.appendChild(span);
            });
            const themeContainer = document.getElementById('theme-suggestions-list');
            themeContainer.innerHTML = `
                <div class="bg-white/10 p-3 rounded-2xl border border-white/10 shadow-sm transition-all active:scale-95">
                    <div class="flex justify-between font-black text-[10px]"><span>#${mainScenario === 'activity' ? '国补全攻略' : '我的开箱实测'}</span><span class="text-yellow-400">HOT</span></div>
                    <div class="text-[9px] opacity-70 mt-1">推荐产品：近期热门旗舰机型</div>
                </div>
            `;
        }

        function handleFileChange(input) { if(input.files.length > 0) document.getElementById('upload-filename').innerText = `文件: ${input.files[0].name}`; }

        function generateContent() {
            const p = document.getElementById('input-product-name').value || '新款手机';
            goToStep(3);
            const tc = document.getElementById('titles-container'); tc.innerHTML = '';
            for(let i=1; i<=3; i++) {
                const d = document.createElement('div'); d.className='p-4 border-2 border-gray-100 rounded-2xl bg-white mb-2 cursor-pointer text-xs font-black shadow-sm';
                d.innerHTML=`方案 ${i}: ${p} 门店实拍，这一波国补真的香哭了 ✨`;
                d.onclick=() => {
                    document.getElementById('template-viewer').classList.remove('hidden');
                    document.getElementById('full-template-text').innerText=`【标题】：${p}别再乱买！看完这篇真的省下大几千！\n\n【正文】：\n家人们！真的被${p}惊艳到了...\n坐标：${userState.store}\n现在的政策真的给力，直接到店报暗号更有惊喜！\n\n#${p} #手机换新 #同城好店 #数码测评`;
                };
                tc.appendChild(d);
            }
            initCanvas(p);
        }

        function initCanvas(p) {
            const c = document.getElementById('preview-canvas'); const ctx = c.getContext('2d');
            c.width=320; c.height=180; ctx.fillStyle='#f0f2f5'; ctx.fillRect(0,0,320,180);
            ctx.fillStyle='#ff4d4f'; ctx.beginPath(); ctx.roundRect(15, 15, 90, 30, 8); ctx.fill();
            ctx.fillStyle='white'; ctx.font='bold 12px Arial'; ctx.fillText('同城现货', 23, 34);
            ctx.fillStyle='#1890ff'; ctx.font='bold 16px Arial'; ctx.fillText(p + ' 实拍图位', 110, 100);
        }

        function saveAndReturnHome() {
            const pName = document.getElementById('input-product-name').value || '机型';
            const content = document.getElementById('full-template-text').innerText;
            if(!content) return showToast('请选择笔记方案');
            historyData.unshift({ id: Date.now(), date: new Date().toLocaleString(), product: pName, content: content });
            showToast("保存成功");
            document.getElementById('input-product-name').value = '';
            goToStep(1);
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            if(historyData.length === 0) { list.innerHTML = `<div class="text-center py-20 text-gray-300 font-bold">暂无记录</div>`; return; }
            historyData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'p-5 border-2 border-gray-50 rounded-[2rem] bg-white shadow-sm';
                card.innerHTML = `<div class="flex justify-between items-center text-[10px] mb-2 font-black"><span>${item.product}</span><span>${item.date}</span></div><p class="text-[11px] text-gray-400 line-clamp-2 italic">${item.content.substring(0, 60)}...</p>`;
                list.appendChild(card);
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast'); t.innerText = msg;
            t.classList.remove('hidden'); setTimeout(() => t.classList.add('hidden'), 2500);
        }

        function copyContent() { showToast('已复制'); }

        window.onload = () => switchView('view-login');
    </script>
</body>
</html>